jQuery(document).ready(function($){function e(e){var a=e.value.length;a>=1300?(e.value=e.value.substring(0,1300),$(".letter-count").text(1300)):$(".letter-count").text(a)}$.ajaxSetup({cache:!1}),jQuery.validator.addMethod("referenznummer",function(e,a){return/^[0-9]{6,8}$/.test(e)},"Please enter a valid reference."),jQuery.validator.addMethod("patenkindnummer",function(e,a){return/^[A-Z]{2}[0-9]{7,9}$/.test(e)},"Please enter a valid child number."),$.validator.addMethod("maxfilesize",function(e,a){return this.optional(a)||a.files&&a.files[0]&&a.files[0].size<2097152&&("image/png"==a.files[0].type||"image/jpg"==a.files[0].type||"image/jpeg"==a.files[0].type)},"Bitte beachten Sie die Vorgaben fÃ¼r den Bild-Upload/Merci de respecter les indications pour l'envoi d'une photo");var a=function(e){$(".send-fail").hide(),$("#loading-modal").removeClass("preview-loading send-loading send-success send-fail").addClass(e).foundation("open"),$(".loading-icon").show()},n=function(){$("#loading-modal").removeClass("preview-loading send-loading send-success"),$(".send-fail").show(),$(".loading-icon").hide()},t=function(){$("#loading-modal").removeClass("preview-loading send-loading send-success send-fail").foundation("close")},o=function(){$(".compassion-letter-form")[0].reset(),$(".iradio_flat-aero").removeClass("checked"),$(".letter-count").text(0)};$(".compassion-letter-form").validate({rules:{referenznummer:"referenznummer",patenkind:"patenkindnummer",image:"maxfilesize"},errorPlacement:function(e,a){"radio"===a.attr("type")?a.parents(".radio-wrapper").first().prepend(e):a.after(e)},submitHandler:function(e){var t=new FormData(jQuery(".compassion-letter-form")[0]);return a("send-loading"),t.append("action","compassion_letters_send"),t.append("lang",wp_data.lang),$.ajax({url:wp_data.admin_ajax,data:t,type:"POST",contentType:!1,processData:!1,lang:wp_data.lang,dataType:"json",success:function(e){e.success?(a("send-success"),$(".loading-icon").hide(),o()):n()},error:function(e){console.log("Error: "+e),n()}}),!1}}),$(".compassion-letter-form textarea").on("keyup",function(){e(this)}),$("#fileUpload").change(function(e){var a="";a=this.files&&this.files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value.split("\\").pop(),a?$("#filename").val(a):$("#filename").val("")}),$("#clear-file-input").click(function(){$("#fileUpload").val(""),$("#filename").val("");var e=$("#fileUpload");return e.wrap("<form>").closest("form").get(0).reset(),e.unwrap(),$("#pdf_path").val(""),!1}),$(".compassion-letter-form .clear-pdf-on-change, .compassion-letter-form input[name=template]:radio").on("change",function(){$("#pdf_path").val("")}),$("input[name=template]").on("ifToggled",function(){$("#pdf_path").val("")}),$("body").on("click","#preview-send-button",function(){var e=new FormData(jQuery(".compassion-letter-form")[0]);return $("#preview-modal").foundation("close"),a("send-loading"),e.append("action","compassion_letters_send"),e.append("lang",wp_data.lang),$.ajax({url:wp_data.admin_ajax,data:e,type:"POST",contentType:!1,lang:wp_data.lang,processData:!1,dataType:"json",success:function(e){e.success?(a("send-success"),$(".loading-icon").hide(),o()):n()},error:function(e){n(),console.log("Error: "+e)}}),!1}),$("body").on("click","#preview-button",function(){if($(".compassion-letter-form").valid()){a("preview-loading");var e=new FormData(jQuery(".compassion-letter-form")[0]);e.append("action","compassion_letters_preview"),e.append("lang",wp_data.lang),$.ajax({url:wp_data.admin_ajax,data:e,type:"POST",lang:wp_data.lang,contentType:!1,processData:!1,dataType:"json",success:function(e){var a=e.thumbnails,n=e.thumbnailURL;$("#preview-modal .content").html(""),$.each(a,function(e,a){$("#preview-modal .content").append('<div class="page"><h4>Seite '+parseInt(e+1)+'</h4><img src="'+n+a+'" /></div>')}),a.length>1?$("#preview-modal").addClass("large"):$("#preview-modal").removeClass("large"),t(),$("#preview-modal").foundation("open"),$("#pdf_path").val(e.pdf)},error:function(e){console.log("Error: "+e)}})}return!1}),$("body").on("click",".close-reveal-modal",function(){$(this).parents(".reveal").foundation("close")})});