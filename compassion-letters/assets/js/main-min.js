jQuery(document).ready(function(a){a.ajaxSetup({cache:!1});jQuery.validator.addMethod("referenznummer",function(a,c){return/^[0-9]{6,8}$/.test(a)},"Please enter a valid reference.");jQuery.validator.addMethod("patenkindnummer",function(a,c){return/^[A-Z]{2}[0-9]{7,9}$/.test(a)},"Please enter a valid child number.");a.validator.addMethod("maxfilesize",function(a,c){return this.optional(c)||c.files&&c.files[0]&&2097152>c.files[0].size&&("image/png"==c.files[0].type||"image/jpg"==c.files[0].type||"image/jpeg"==
c.files[0].type)},"Bitte beachten Sie die Vorgaben f\u00fcr den Bild-Upload/Merci de respecter les indications pour l'envoi d'une photo");var d=function(b){a(".send-fail").hide();a("#loading-modal").removeClass("preview-loading send-loading send-success send-fail").addClass(b).foundation("open");a(".loading-icon").show()},e=function(){a("#loading-modal").removeClass("preview-loading send-loading send-success");a(".send-fail").show();a(".loading-icon").hide()},f=function(){a(".compassion-letter-form")[0].reset();
a(".iradio_flat-aero").removeClass("checked");a(".icheckbox_flat-aero").removeClass("checked");a(".letter-count").text(0)};a(".compassion-letter-form").validate({rules:{referenznummer:"referenznummer",patenkind:"patenkindnummer",image:"maxfilesize"},errorPlacement:function(a,c){"radio"===c.attr("type")?c.parents(".radio-wrapper").first().prepend(a):c.after(a)},submitHandler:function(b){b=new FormData(jQuery(".compassion-letter-form")[0]);d("send-loading");b.append("action","compassion_letters_send");
b.append("lang",wp_data.lang);a.ajax({url:wp_data.admin_ajax,data:b,type:"POST",contentType:!1,processData:!1,lang:wp_data.lang,dataType:"json",success:function(b){b.success?(d("send-success"),a(".loading-icon").hide(),f()):e()},error:function(a){console.log("Error: "+a);e()}});return!1}});a(".compassion-letter-form textarea").on("keyup",function(){var b=this.value.length;1300<=b?(this.value=this.value.substring(0,1300),a(".letter-count").text(1300)):a(".letter-count").text(b)});a("#fileUpload").change(function(b){(b=
this.files&&1<this.files.length?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):b.target.value.split("\\").pop())?a("#filename").val(b):a("#filename").val("")});a("#clear-file-input").click(function(){a("#fileUpload").val("");a("#filename").val("");var b=a("#fileUpload");b.wrap("<form>").closest("form").get(0).reset();b.unwrap();a("#pdf_path").val("");return!1});a(".compassion-letter-form .clear-pdf-on-change, .compassion-letter-form input[name=template]:radio").on("change",
function(){a("#pdf_path").val("")});a("input[name=template]").on("ifToggled",function(){a("#pdf_path").val("")});a("body").on("click","#preview-send-button",function(){var b=new FormData(jQuery(".compassion-letter-form")[0]);a("#preview-modal").foundation("close");d("send-loading");b.append("action","compassion_letters_send");b.append("lang",wp_data.lang);a.ajax({url:wp_data.admin_ajax,data:b,type:"POST",contentType:!1,lang:wp_data.lang,processData:!1,dataType:"json",success:function(b){b.success?
(d("send-success"),a(".loading-icon").hide(),f()):e()},error:function(a){e();console.log("Error: "+a)}});return!1});a("body").on("click","#preview-button",function(){if(a(".compassion-letter-form").valid()){d("preview-loading");var b=new FormData(jQuery(".compassion-letter-form")[0]);b.append("action","compassion_letters_preview");b.append("lang",wp_data.lang);a.ajax({url:wp_data.admin_ajax,data:b,type:"POST",lang:wp_data.lang,contentType:!1,processData:!1,dataType:"json",success:function(b){var c=
b.thumbnails,d=b.thumbnailURL;a("#preview-modal .content").html("");a.each(c,function(b,c){a("#preview-modal .content").append('<div class="page"><h4>Seite '+parseInt(b+1)+'</h4><img src="'+d+c+'" /></div>')});1<c.length?a("#preview-modal").addClass("large"):a("#preview-modal").removeClass("large");a("#loading-modal").removeClass("preview-loading send-loading send-success send-fail").foundation("close");a("#preview-modal").foundation("open");a("#pdf_path").val(b.pdf)},error:function(a){console.log("Error: "+
a)}})}return!1});a("body").on("click",".close-reveal-modal",function(){a(this).parents(".reveal").foundation("close")});a(".send-success > #schliess-button").on("click",function(){var b=a("#rowdon");b.length&&a("html, body").delay(300).animate({scrollTop:b.offset().top-50},1E3)})});
